---
output:
  html_document:
    css: ["../www/css/main.css", "../www/css/tabBoxes.css", "../www/css/footer.css"]
---

## COVID-19 {.tabset .tabset-fade}

```{r include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, eval = TRUE)
options(encoding = "UTF-8")
options(scipen=999)
```

```{r include = FALSE}
library(magrittr)
library(ggplot2)
library(ggrepel)
library(stringr)

tpltheme::set_tpl_theme(style = "print", font = "lato")

rm(list = ls())
options(encoding = "UTF-8")

sapply(list.files("../R", full.names = TRUE, recursive = TRUE), source, .GlobalEnv)

county <- create_data.county()

state <- create_data.state()

usa <- create_data.usa()

world <- create_data.world()

usafacts_source <- "Confirmed COVID-19 cases and deaths: USAFacts Data (https://usafacts.org/)"
census_source <- "Population data: 2018 American Community Survey 5-year Estimates"
covid_tracking_source <- "Testing data: The Covid Tracking Project (https://covidtracking.com/)"
world_data_source <- "Johns Hopkins Center for Systems Science and Engineering  (https://github.com/CSSEGISandData/COVID-19)"

```

### World

#### Timelines

The following graphs show the timelines of when different countries tried different interventions over time. One article suggests that the number of people with COVID-19 is doubling every 6 days.[10] China is one of a few countries who has been successful in "flattening the curve". On January 23rd, 2020 they implemented one of the most extreme interventions - quarantine in Wuhan and three other cities. On January 24th, 2020 the Chinese government expanded the quarantine to the entire Hubei province. It wasn't until XXX days after the quarantine was implemented that scientists agreed China had successfully flattened the curve.

##### United States

```{r}

us <- world %>% dplyr::filter(country == "US" & is.na(stateName))

gg <- ggplot(us, aes(x = Date, y = confirmed, label = str_wrap(label, width = 65))) + 
  geom_point(color = "#e54e4d") +
  geom_line() +
  labs(y = "Confirmed cases",
       x = "Date",
       caption = paste("Source:", world_data_source))

gg <- text_format(gg, hjust = 1, nudge_x = 20)
gg <- pandemic_declared(gg, df = us)
print(gg)

```

##### China

```{r}

china <- world %>% dplyr::filter(country == "China")

gg <- ggplot(china, aes(x = Date, y = confirmed, label = str_wrap(label, width = 65))) + 
  geom_point(color = "#e54e4d") +
  geom_line() +
  labs(y = "Confirmed cases",
       x = "Date",
       caption = paste("Source:", world_data_source))

gg <- text_format(gg)
gg <- pandemic_declared(gg, df = china)
print(gg)
```

##### Italy

```{r}

italy <- world %>% dplyr::filter(country == "Italy")

gg <- ggplot(italy, aes(x = Date, y = confirmed, label = str_wrap(label, width = 100))) +
  geom_point(color = "#e54e4d") +
  geom_line() +
  labs(y = "Confirmed cases",
       x = "Date",
       caption = paste("Source:", world_data_source))

gg <- text_format(gg, hjust = 1, nudge_x = 20, box_padding = 1)
gg <- pandemic_declared(gg, df = world)
print(gg)
```

### State Level

```{r}


# line_chart.state.confirmed_cases(df = state %>%
#                              dplyr::filter(State %in% c("TX", "WA", "CA", "NY")))


```

### County Level

```{r}

```

### Discussion and Limitations

While this report provides a selective look at COVID-19 trends at the worldwide, national and state level, it is important to recognize the limitations of the data. Restrictive measures, testing capacity, and monitoring protocols vary between countries. The testing capacity of Italy and China far exceeds that of the United States; a greater number of confirmed cases will be seen in areas that test more individuals. While the United States is working to make more coronavirus tests available, demand still exceeds availability. As such, the reported number of confirmed cases is presumed to be less than the total number of cases. 
 
In the US, differences in testing and restrictive measures taken by individual states and counties must also be taken into account. Each state has a different timeline of when its first case was confirmed and the subsequent measures taken to protect its citizens, all of which cover the span of less than two months, with more extreme measures such as "shelter-in-place" occurring within the past week. Furthermore, states are now able to take responsibility for overseeing tests developed and used in their states, but many states do not have the legal authority, expertise, or staff necessary. In states that are able to receive authorization, we would expect the number of tests and confirmed cases to increase. Provided the recently implemented state mandates and the developing nature surrounding the coronavirus, it is too early to say whether such measures are working or to draw definitive conclusions about the trajectory of cases.

##### References

[1 Business Insider: A comprehensive timeline of the new coronavirus pandemic, from China's first COVID-19 case to the present](https://www.businessinsider.com/coronavirus-pandemic-timeline-history-major-events-2020-3#january-13-the-first-coronavirus-case-outside-of-china-was-reported-in-thailand-5)
 
[2 SF Chronicle: Efforts intensify to slow spread of coronavirus, SF bans gatherings of more than 100](https://www.sfchronicle.com/bayarea/article/Efforts-intensify-to-slow-spread-of-coronavirus-15129637.php)
 
[3 New York Times: De Blasio Declares State of Emergency in N.Y.C., and Large Gatherings Are Banned](https://www.nytimes.com/2020/03/12/nyregion/coronavirus-new-york-update.html#link-67d77703)
 
[4 Texas Tribune: Texas governor declares statewide emergency, says state will soon be able to test thousands ](https://www.texastribune.org/2020/03/13/texas-coronavirus-cases-state-emergency-greg-abbott/)
 
[5 CNBC: California announces first coronavirus death, bringing US fatalities to at least 11](https://www.cnbc.com/2020/03/04/california-confirms-first-coronavirus-death-bringing-us-fatalities-to-at-least-11.html)
 
[6 Wall Street Journal: New York State Has First Coronavirus Deaths](https://www.wsj.com/articles/new-york-state-has-first-coronavirus-death-11584198758)
 
[7 Chron: Matagorda County reports first coronavirus-related death in Texas](https://www.chron.com/news/houston-texas/houston/article/matagorda-county-first-coronavirus-death-15136253.php)

[8 NPR: U.S. Coronavirus Testing Starts To Ramp Up But Still Lags](https://www.npr.org/sections/health-shots/2020/03/18/817768723/u-s-coronavirus-testing-starts-to-ramp-up-but-still-lags)
 
[9 Our World in Data: How many tests for COVID-19 are being performed around the world?](https://ourworldindata.org/covid-testing)

[10 The Conversation](https://theconversation.com/how-to-flatten-the-curve-of-coronavirus-a-mathematician-explains-133514)

